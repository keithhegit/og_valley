# Og Valley 功能走查与测试指南

## 📋 测试说明

本文档提供所有已实现功能的测试方法和预期效果。按优先级分组，每项包含测试步骤和成功标准。

------

## 🔴 高优先级功能 (Phase 5)

### 1. 时间系统 (Day/Night Cycle)

**测试方法**:

1. 启动游戏，观察左上角时间显示
2. 等待约 6 秒（游戏内 1 小时）
3. 控制台手动设置时间接近 2:00 AM

**预期效果**:

- ✅ 显示 `Day 1, Spring | 6:00` 格式
- ✅ 时间每秒增加 10 分钟 (6:00 → 6:10 → 6:20...)
- ✅ 达到 26:00 (2:00 AM) 时自动睡觉
- ✅ 显示 "你已昏睡... 新的一天开始了!"
- ✅ 玩家传送至农场 (6, 4)，HP/体力恢复满
- ✅ 时间重置为 6:00 AM，Day +1

------

### 2. 体力消耗强制

**测试方法**:

1. 使用锄头耕地 50 次（消耗 100 体力）
2. 体力归零后再次尝试使用锄头

**预期效果**:

- ✅ 每次耕地扣除 2 体力（右上角显示 Energy: 98/100）
- ✅ 体力不足时显示 "体力不足！" 提示
- ✅ 无法使用工具，角色不执行动作

**Wiki 对照**:

- 官方: Hoe/Watering Can = 2 energy
- 我们: `energy: 2` ✅ 匹配

------

### 3. 食物系统

**测试方法**:

1. 收获 1 个防风草 (Parsnip)
2. 打开背包 (E 键)
3. 右键点击防风草

**预期效果**:

- ✅ 体力增加 15 点
- ✅ 浮动文字显示 "+15 Energy"
- ✅ 物品数量 -1
- ✅ 无法右键点击非食物物品（显示"此物品不可食用"）

**Wiki 对照**:

- 官方: Parsnip 恢复 25 能量 + 11 生命
- 我们: `energyRestore: 15` ⚠️ **需调整至 25**

------

### 4. 玩家死亡/惩罚

**测试方法**:

1. 进入矿井
2. 故意被史莱姆攻击至 HP = 0
3. 记录当前金钱

**预期效果**:

- ✅ HP 归零时显示 "你昏倒了... 失去 Xg"
- ✅ 扣除 10% 金钱
- ✅ 传送至农场 (6, 4)
- ✅ HP 和体力恢复满值
- ✅ 时间重置为 6:00 AM

**Wiki 对照**:

- 官方: 丢失 10% 金钱（最多 1000g）
- 我们: `Math.floor(money * 0.1)` ⚠️ **需添加上限 1000g**

------

### 5. 存档系统

**测试方法**:

1. 进行游戏操作（耕地、收集资源）
2. 睡觉到第 2 天
3. 刷新页面 (F5)

**预期效果**:

- ✅ 页面加载后显示 "游戏加载成功！"
- ✅ 所有状态完整恢复：
  - 玩家位置和库存
  - 地图状态（耕地、作物、箱子）
  - Day/Time/Season
  - 金钱和体力

------

## 🟡 中优先级功能 (Phase 6)

### 6. 工具使用动画

**测试方法**:

1. 使用任何工具（锄头/斧头/镐子）
2. 观察角色动画

**预期效果**:

- ✅ 使用工具时角色执行弹跳动画 (`animate-bounce`)
- ✅ 动画持续约 300ms
- ✅ 同时播放对应音效

------

### 7. 行走动画

**测试方法**:

1. 使用 WASD 移动角色
2. 观察角色精灵变化

**预期效果**:

- ✅ 移动时 `walkFrame` 在 0/1 之间切换
- ✅ PlayerSprite 的 `walking` prop 根据帧状态变化
- ✅ 每次移动播放脚步音效

------

### 8. 音效系统

**测试方法**:

| 操作              | 预期音效                   |
| :---------------- | :------------------------- |
| 耕地              | 低频 150Hz，0.1秒          |
| 浇水              | 中频 400Hz，0.15秒         |
| 破坏岩石          | 刺耳 100Hz 锯齿波，0.08秒  |
| 拾取物品/打开商店 | 高频 800Hz，0.12秒         |
| 移动              | 低频 80Hz 方波，0.05秒     |
| 种植              | 中高频 600Hz 三角波，0.1秒 |

**预期效果**:

- ✅ 每个操作触发对应音效
- ✅ 音效不阻塞游戏
- ✅ 浏览器静音时不报错

------

### 9. 季节系统

**测试方法**:

1. 控制台设置 `gameState.day = 28`
2. 睡觉
3. 尝试种植不同季节的种子

**预期效果**:

- ✅ Day 28 → 29 时切换季节
- ✅ 显示 "Summer 到来了！" 提示
- ✅ 左上角显示新季节名称
- ✅ 春季种子无法在夏季种植（"不适合当前季节种植！"）

**Wiki 对照**:

- 官方: 每季 28 天
- 我们: `if (newDay > 28) { newDay = 1; seasonIdx++; }` ✅ 匹配

------

### 10. House 室内场景

**测试方法**:

1. 移动至农场房子门口 (2, 3)
2. 按空格进入
3. 内部探索

**预期效果**:

- ✅ 传送至 HOUSE 场景，玩家位于 (7, 9)
- ✅ 地板为 HOUSE_FLOOR 类型
- ✅ 床位置 (3-5, 2) 不可行走
- ✅ 电视位置 (10, 5) 不可行走
- ✅ 箱子位于 (2, 5) 可交互
- ✅ 门口 (7, 9) 可传送回农场 (2, 4)

------

## 🟢 低优先级功能 (Phase 6)

### 11. 鼠标点击交互

**测试方法**:

1. 用鼠标点击玩家相邻的格子
2. 点击玩家自身或远处格子

**预期效果**:

- ✅ 点击相邻格子：角色转向 + 自动交互
- ✅ 点击非相邻格子：无反应
- ✅ 点击 NPC：自动面向并触发对话
- ✅ 点击岩石/树木：自动面向并破坏

------

### 12-13. 新工具 (镰刀/钓竿)

**测试方法**:

1. 检查初始库存 slot[5] 和 [6]
2. 装备镰刀，清理杂草
3. 装备钓竿（暂无钓鱼逻辑）

**预期效果**:

- ✅ 镰刀 (ID 106)：0 体力消耗，可清理杂草
- ✅ 钓竿 (ID 107)：0 体力消耗，显示在库存
- ✅ 鼠标悬停显示工具说明 tooltip

------

### 14. 特殊矿脉

**测试方法**:

1. 进入矿井 (MINE 场景)
2. 探索并记录矿脉类型
3. 收集 50 个矿脉样本统计概率

**预期效果**:

- ✅ 矿井生成以下矿脉（概率分布）：
  - 铜矿脉 (ID 75) - 约30%，掉落铜矿 (378)
  - 铁矿脉 (ID 76) - 约15%，掉落铁矿 (380)
  - 金矿脉 (ID 77) - 约5%，掉落金矿 (384)
  - 普通石头 (ID 2) - 约50%，掉落石头 (390)

**Wiki 对照**:

- 官方矿脉掉落: Copper/Iron/Gold Ore
- 我们: `drop: 378/380/384` ✅ 匹配ID

------

### 15. NPC 好感度

**测试方法**:

1. 与市长对话
2. 记录浮动文字
3. 再次对话（同一天）
4. 睡觉后第二天再对话

**预期效果**:

- ✅ 首次对话显示 "+10 💚"
- ✅ NPC 的 `affection` 增加 10（最大 250）
- ✅ 同一天再次对话无好感度增长
- ✅ 次日对话重新获得 +10
- ✅ `lastTalked` 字段更新为当前 day

------

## 📊 Wiki 数值对照总结

| 项目             | 官方 Wiki         | 当前实现     | 状态       |
| :--------------- | :---------------- | :----------- | :--------- |
| Parsnip 种子价格 | 20g               | 20g          | ✅          |
| Parsnip 售价     | 35g               | 35g          | ✅          |
| Parsnip 生长时间 | 4天               | 4天          | ✅          |
| Parsnip 能量恢复 | +25 能量 +11 生命 | +15 能量     | ⚠️ 需调整   |
| 工具体力消耗     | 2                 | 2            | ✅          |
| 玩家初始体力     | 270               | 100          | ⚠️ 简化版   |
| 死亡金钱损失     | 10% (最多1000g)   | 10% (无上限) | ⚠️ 需加上限 |
| 每季天数         | 28天              | 28天         | ✅          |
| 铜/铁/金矿石ID   | 378/380/384       | 378/380/384  | ✅          |

------

## 🔧 建议调整

1. **Parsnip 能量恢复**: 从 15 改为 25
2. **死亡惩罚上限**: 添加 `Math.min(1000, Math.floor(money * 0. 1))`
3. **玩家初始体力**: 考虑从 100 改为 270（可选，简化版保留100也可）

------

## ✅ 完整测试清单

-  时间流逝正常，2AM 强制睡觉
-  体力耗尽无法使用工具
-  食物恢复体力
-  死亡丢失金钱并复活
-  存档保存/加载完整
-  工具使用有弹跳动画
-  移动时有行走帧切换
-  所有操作有对应音效
-  季节28天后自动切换
-  春季作物不能种在其他季节
-  房子门口可进入HOUSE场景
-  鼠标点击相邻格子可交互
-  镰刀和钓竿显示在库存
-  矿井生成铜/铁/金矿脉
-  与NPC对话增加好感度

------

**测试环境**: Cloudflare Pages (phase5 分支)
**更新日期**: 2025-11-24
**测试者**: _______________