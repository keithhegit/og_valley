# Og Valley: 项目文档

## 1. 产品需求文档 (PRD)

### 1.1 产品概述
**Og Valley** 是一款基于 React 和现代 Web 技术构建的网页版农业 RPG，灵感来源于《星露谷物语》。它旨在提供即点即玩、无需下载的游戏体验，包含耕种、探索、战斗和经济系统。

### 1.2 核心玩法循环
1.  **采集**: 使用工具收集木材、石头和纤维。
2.  **耕种**: 开垦土地、播种、浇水并收获农作物。
3.  **交易**: 出售农作物换取金币，或从商店购买种子/物品。
4.  **探索**: 在农场、城镇和矿井之间穿梭。
5.  **战斗**: 在矿井中与怪物战斗以生存并获取战利品。

### 1.3 关键特性
-   **角色系统**: 生命值 (HP)、体力 (Energy)、金钱 (Money) 和库存管理。
-   **库存与存储**:
    -   24 格背包 (可扩展 UI)。
    -   可放置的箱子用于存储物品。
    -   拖拽式物品管理。
-   **世界系统**:
    -   **农场**: 建设和耕种的主要基地。
    -   **城镇**: 拥有 NPC (镇长 Lewis, 奶奶 Granny) 的社交中心。
    -   **矿井**: 充满怪物 (史莱姆) 和资源的危险区域。
-   **交互**:
    -   工具使用 (锄头, 喷壶, 斧头, 镐子, 剑)。
    -   对象交互 (箱子, 出货箱, 邮箱)。
    -   NPC 对话系统。

---

## 2. 技术架构

### 2.1 技术栈
-   **前端**: React 18 (Hooks + Functional Components)
-   **构建工具**: Vite
-   **语言**: TypeScript
-   **样式**: Tailwind CSS + Inline Styles (用于动态定位)
-   **图标**: Lucide React

### 2.2 核心架构
-   **游戏循环**: React State 驱动的伪实时循环。`useEffect` 处理定时器 (怪物, 浮动文字)，而用户输入触发即时状态更新。
-   **数据模型**:
    -   **ID 驱动**: 所有对象、物品和地块都由 `ITEM_DB` 中定义的整数 ID 引用。
    -   **网格系统**: `TileData[][]` 表示地图。
    -   **多场景**: 状态保存所有场景的网格数据 `Record<SceneName, TileData[][]>`。
-   **渲染**:
    -   **混合渲染器**: 使用基于 CSS 的像素艺术组件 (`PixelArt.tsx`)，根据物品 ID 进行映射。
    -   **虚拟 DOM**: React 高效地仅更新变化的图块。

### 2.3 数据结构
**物品数据库 (`ITEM_DB`)**:
静态配置表，将 ID 映射到属性 (名称, 类型, 精灵图, 属性)。
```typescript
const ITEM_DB = {
  2: { name: 'Stone Node', type: 'obstacle', drop: 390, ... },
  130: { name: 'Chest', type: 'container', slots: 9, ... },
  // ...
}
```

**状态管理**:
-   `player`: 位置, 属性, 库存。
-   `grids`: 所有场景的地图数据。
-   `containers`: 箱子的持久化存储 (`Scene_X_Y` 作为键)。
-   `monsters`: 活动实体数组。

---

## 3. 路线图与状态

### ✅ 第一阶段：基础建设 (已完成)
-   核心引擎 (网格, 玩家移动)
-   基础耕种 (耕地, 浇水, 收获)
-   资源采集 (树木, 岩石)

### ✅ 第二阶段：经济与数据 (已完成)
-   基于 ID 的物品系统 (`ITEM_DB`)
-   出货箱与邮箱商店
-   浮动文字反馈

### ✅ 第三阶段：库存与存储 (已完成)
-   [x] 完整背包 UI (按 'E' 键)
-   [x] 箱子系统 (放置/打开/存储)
-   [x] 拖拽物品管理
-   [x] 垃圾桶功能

### ✅ 第四阶段：世界与战斗 (已完成)
-   [x] 多场景架构 (农场, 城镇, 矿井)
-   [x] 传送点 (场景切换)
-   [x] 基础战斗 (剑 vs 史莱姆)
-   [x] 怪物 AI (简单追逐)

### 🚧 第五阶段：打磨与持久化 (下一步)
-   [ ] **存档系统**: 将 `grids`, `player`, 和 `containers` 持久化到 `localStorage`。
-   [ ] **音频**: 实现动作音效和背景音乐。
-   [ ] **视觉效果**: 添加工具动画和玩家行走帧。
-   [ ] **移动端支持**: 移动和交互的触摸控制。

### 🔮 未来阶段
-   **第六阶段**: 进阶耕种 (季节, 更多作物)。
-   **第七阶段**: 社交 (NPC 日程表, 好感度)。
-   **第八阶段**: 房屋自定义 (家具, 升级)。
